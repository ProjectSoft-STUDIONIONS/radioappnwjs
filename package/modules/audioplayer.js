var helper=require("./helper"),EventDispatcher=function(){};Object.assign(EventDispatcher.prototype,{addEventListener:function(V,e){void 0===this._listeners&&(this._listeners={});var t=this._listeners;void 0===t[V]&&(t[V]=[]),-1===t[V].indexOf(e)&&t[V].push(e)},hasEventListener:function(V,e){if(void 0===this._listeners)return!1;var t=this._listeners;return void 0!==t[V]&&-1!==t[V].indexOf(e)},removeEventListener:function(V,e){if(void 0!==this._listeners){var t=this._listeners[V];if(void 0!==t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}}},dispatchEvent:function(V){if(void 0!==this._listeners){var e=this._listeners[V.type];if(void 0!==e){V.target=this;var t=[],i=0,s=e.length;for(i=0;i<s;i++)t[i]=e[i];for(i=0;i<s;i++)t[i].call(this,V)}}}});var _this,timeupdate,audio,_isPlaying=!1,_isProgress=!1,_net=!1,_volume=1,_status="online",_stream="data:audio/mpeg;base64,/+MQwAAAAANIAYAAAExBTUUzLjkzVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/jEMAnAAADSAHAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/4xDATgAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",audioEvents=["emptied","loadedmetadata","loadeddata","canplay","canplaythrough","playing","ended","waiting","ended","durationchange","timeupdate","play","playing","pause","progress","stalled","suspend","ratechange","volumechange"],audioHandler=function(V){switch(V.type){case"volumechange":_this.dispatchEvent({type:V.type,volume:_volume});break;case"play":case"waiting":_isProgress=!0,_isPlaying=!0,_net=!0,_this.dispatchEvent({type:"statechange",audioev:"play",bufering:_isProgress,playing:_isPlaying});break;case"canplay":break;case"playing":timeupdate&&clearTimeout(timeupdate),_isProgress=!1,_isPlaying=!0,_net=!0,_this.dispatchEvent({type:"statechange",audioev:"playing",bufering:_isProgress,playing:_isPlaying});break;case"ended":case"abort":case"emptied":case"error":case"pause":timeupdate&&clearTimeout(timeupdate),_net=_isPlaying=_isProgress=!1,_this.dispatchEvent({type:"statechange",audioev:"stop",bufering:_isProgress,playing:_isPlaying});break;case"timeupdate":if(timeupdate&&clearTimeout(timeupdate),_isProgress&&4==audio.readyState)return _isProgress=!1,void _this.dispatchEvent({type:"statechange",audioev:"progress",bufering:_isProgress,playing:!0});_isProgress&&(timeupdate=setTimeout(function(){_isProgress=!0,_this.dispatchEvent({type:"statechange",audioev:"progress",bufering:_isProgress,playing:!0})},150))}};function AudioPlayer(V){function e(V){var e=_net;return _status=V.type,"offline"==V.type?_this.stop():"online"==V.type&&e&&_this.play(),_this.dispatchEvent({type:"networkchange",state:V.type}),setTimeout(function(){_net=e},200),V.preventDefault(),!1}return _this=this,(audio=new Audio).crossOrigin="anonymous",audio.preload="none",audioEvents.forEach(function(V,e){audio.addEventListener(V,audioHandler)}),audio.controls=null,V.body.appendChild(audio),window.addEventListener("online",e),window.addEventListener("offline",e),_this}AudioPlayer.prototype={isPlaying:function(){return _isPlaying},isProgress:function(){return _isProgress},toggle:function(){_isPlaying?this.stop():this.play()},set stream(V){_stream=V,this.isPlaying()&&(this.stop(),this.play())},get stream(){return _stream},set volume(V){(_volume=helper.inInterval(V,0,1))!=audio.volume&&(audio.volume=_volume)},get volume(){return _volume},set audioElement(V){throw new Error("not audio")},get audioElement(){return audio},play:function(){_isPlaying=!0,audio.src=this.stream,setTimeout(function(){audio.play()},10)},stop:function(){audio.pause(),audio.src="data:audio/mpeg;base64,/+MQwAAAAANIAYAAAExBTUUzLjkzVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/jEMAnAAADSAHAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/4xDATgAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",audio.currentTime=0}},Object.assign(AudioPlayer.prototype,EventDispatcher.prototype),"undefined"==typeof exports?window.AudioPlayer=AudioPlayer:module.exports=AudioPlayer;